<ng-container *ngIf="isVisible">

  <!-- Overlay -->
  <div
    class="fixed inset-0 z-[9998] bg-black/30 backdrop-blur-sm transition-opacity duration-300 opacity-100"
    (click)="onClose()"
  ></div>

  <!-- Wrapper (só pra centralizar stack e permitir animação do slide) -->
  <div class="fixed inset-0 z-[9999] pointer-events-none">
    
    <!-- Painel -->
    <div 
  role="dialog" 
  class="pointer-events-auto absolute top-0 right-0 h-screen w-full max-w-[476px]
         bg-white border-l flex flex-col overflow-visible
         transform transition-transform duration-300 ease-in-out translate-x-0"
  (click)="$event.stopPropagation()"
>
  <div class="absolute top-6 -left-1 hidden lg:block">
    <app-botaox (onClose)="onClose()"></app-botaox>
  </div>

  <div class="pt-8 flex-shrink-0 relative">
    <div class="flex px-3 items-center justify-between">
      <div class="flex flex-col justify-between py-3 px-4">
        <h2 class="text-lg font-medium text-black">Filtros da dashboard</h2>
        <p class="font-sans font-medium text-[12px] leading-4 tracking-[-1%] text-gray-500">
          Selecione os filtros desejados abaixo
        </p>
      </div>
      
      <button (click)="onClose()" class="p-4 lg:hidden">
         <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
         </svg>
      </button>
    </div>
        <button
          type="button"
          class="flex items-center py-3 px-6 text-sm font-medium text-blue-500 lg:hidden"
          (click)="navigateToSimpleSearch()"
        >
          Voltar para busca simples
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round" class="ml-1">
            <path d="m9 18 6-6-6-6"></path>
          </svg>
        </button>
      </div>

  <div class="accordion-section py-4 border-b">
  <div class="accordion-header flex justify-between items-center py-4 px-4 cursor-pointer" (click)="toggleSection('keywords')">
    <span class="text-sm font-medium text-gray-900 hover:text-[#2563EB] transition-colors duration-200">Palavras-chave</span>
    <svg [ngClass]="{'rotate-180': isSectionOpen['keywords']}" class="w-5 h-5 text-gray-500 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2">
      <path d="m6 9 6 6 6-6"></path>
    </svg>
  </div>

  <div class="overflow-hidden transition-all duration-200 ease-in-out" 
       [ngClass]="{'max-h-[600px] opacity-100 pb-4 px-4': isSectionOpen['keywords'], 'max-h-0 opacity-0': !isSectionOpen['keywords']}">
    
    <div class="flex flex-col items-start gap-[6px] w-full">
      
      <div class="flex flex-row flex-wrap items-start gap-[4px] w-full">
        <div *ngFor="let tag of activeTags" class="badge-and-tag active-tag">
          <div class="placeholder-container">
            <span class="tag-text">{{ tag }}</span>
          </div>
          <div class="close-icon-wrapper grey-bg cursor-pointer" (click)="removeTag(tag)">
            <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0 7.5C0 3.35786 3.35786 0 7.5 0C11.6421 0 15 3.35786 15 7.5C15 11.6421 11.6421 15 7.5 15C3.35786 15 0 11.6421 0 7.5Z" fill="#D1D5DB"/>
              <path d="M9.5 5.5L5.5 9.5" stroke="#6B7280" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M5.5 5.5L9.5 9.5" stroke="#6B7280" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
      </div>

      <div class="flex flex-row flex-wrap items-start gap-[4px] w-full mt-2" *ngIf="suggestions.length > 0">
        <div *ngFor="let suggestion of suggestions" class="badge-and-tag suggestion-tag cursor-pointer" (click)="addSuggestion(suggestion)">
          <div class="placeholder-container">
            <span class="tag-text">{{ suggestion }}</span>
          </div>
          <div class="close-icon-wrapper blue-bg">
            <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4 1V7M1 4H7" stroke="#2563EB" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
    <div class="accordion-section py-4 border-b">
      <div class="accordion-header flex justify-between items-center py-4 px-4 cursor-pointer" (click)="toggleSection('date')">
        <span class="text-sm font-medium text-gray-900 hover:text-[#2563EB] transition-colors duration-200">Período</span>
        <svg [ngClass]="{'rotate-180': isSectionOpen['date']}" class="w-5 h-5 text-gray-500 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
        </svg>
      </div>
      <div class="overflow-hidden transition-all duration-300 ease-in-out" [ngClass]="{'max-h-[600px] opacity-100 pb-4 px-4': isSectionOpen['date'], 'max-h-0 opacity-0': !isSectionOpen['date']}">
        <div class="flex flex-row gap-2 lg:hidden">
          <div class="datepicker-container relative w-1/2">
            <input 
              type="date" 
              class="w-full h-[61px] px-3 py-2 text-sm border border-gray-300 rounded-lg bg-gray-100 text-gray-700 focus:outline-none focus:border-blue-500 focus:shadow-[0_0_0_3px_#bfdbfe] transition-all duration-200 appearance-none"
              placeholder="Data nício" 
              [(ngModel)]="selectedStartDateMobile" 
              (change)="onMobileDateChange('start', $event)" 
            />
          </div>
          <div class="datepicker-container relative w-1/2">
            <input 
              type="date" 
              class="w-full h-[61px] px-3 py-2 text-sm border border-gray-300 rounded-lg bg-gray-100 text-gray-700 focus:outline-none focus:border-blue-500 focus:shadow-[0_0_0_3px_#bfdbfe] transition-all duration-200 appearance-none"
              placeholder="Data Fim" 
              [(ngModel)]="selectedEndDateMobile" 
              (change)="onMobileDateChange('end', $event)" 
            />
          </div>
        </div>
        <div class="hidden lg:flex flex-col sm:flex-row gap-2">
          <div class="datepicker-container relative">
            <input 
              class="w-[190px] h-[61px] mt-2 px-3 py-2 text-sm border border-gray-300 rounded-lg bg-gray-100 text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-300 appearance-none"
              type="text" 
              placeholder="Data Início" 
              (click)="openCalendar('start')" 
              [value]="selectedStartDate | date: 'dd/MM/yyyy'" 
              readonly 
            />
          </div>
          <div class="datepicker-container relative">
            <input 
              class="w-[190px] h-[61px] mt-2 px-3 py-2 text-sm border border-gray-300 rounded-lg bg-gray-100 text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-300 appearance-none"
              type="text" 
              placeholder="Data Fim" 
              (click)="openCalendar('end')" 
              [value]="selectedEndDate | date: 'dd/MM/yyyy'" 
              readonly 
            />
          </div>
        </div>
      </div>

      <div class="fixed inset-0" *ngIf="showCalendar" (click)="closeCalendar()"></div>
      <div class=" fixed top-1/2 left-[20%] transform -translate-x-[40%] -translate-y-1/2 bg-white rounded-lg shadow-xl" *ngIf="showCalendar">
        <app-calendar (dateSelected)="onDateSelected($event)"></app-calendar>
      </div>
    </div>
    <div class="accordion-section py-4 border-b">
      <div class="accordion-header flex justify-between items-center py-4 px-4 cursor-pointer" (click)="toggleSection('media')">
        <span class="text-sm font-medium text-gray-900 hover:text-[#2563EB] transition-colors duration-200">Tipos de mídia</span>
        <svg [ngClass]="{'rotate-180': isSectionOpen['media']}" class="w-5 h-5 text-gray-500 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m6 9 6 6 6-6"></path>
        </svg>
      </div>
    <div
  class="overflow-hidden transition-all duration-200 ease-in-out"
  [ngClass]="{
    'max-h-[600px] opacity-100 pb-4': isSectionOpen['media'],
    'max-h-0 opacity-0': !isSectionOpen['media']
  }"
>
  <div class="px-4 pl-4">
    <label class="flex items-center gap-2 py-1">
      <input type="checkbox" [(ngModel)]="mediaTypes.audio" class="w-4 h-4 accent-blue-600 cursor-pointer" />
      <span class="text-sm font-medium text-gray-900">Áudio</span>
    </label>

    <label class="flex items-center gap-2 py-1">
      <input type="checkbox" [(ngModel)]="mediaTypes.text" class="w-4 h-4 accent-blue-600 cursor-pointer" />
      <span class="text-sm font-medium text-gray-900">Texto Impresso</span>
    </label>

    <label class="flex items-center gap-2 py-1">
      <input type="checkbox" [(ngModel)]="mediaTypes.text" class="w-4 h-4 accent-blue-600 cursor-pointer" />
      <span class="text-sm font-medium text-gray-900">Texto Web</span>
    </label>

    <label class="flex items-center gap-2 py-1">
      <input type="checkbox" [(ngModel)]="mediaTypes.video" class="w-4 h-4 accent-blue-600 cursor-pointer" />
      <span class="text-sm font-medium text-gray-900">Vídeo</span>
    </label>
  </div>
</div>

    </div>

     <div class="accordion-section py-4 border-b">
      <div class="accordion-header flex justify-between items-center py-4 px-4 cursor-pointer" (click)="toggleSection('tier')">
        <span class="text-sm font-medium text-gray-900 hover:text-[#2563EB] transition-colors duration-200">Tier</span>
        <svg [ngClass]="{'rotate-180': isSectionOpen['tier']}" class="w-5 h-5 text-gray-500 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m6 9 6 6 6-6"></path>
        </svg>
      </div>
   <div
  class="overflow-hidden transition-all duration-200 ease-in-out"
  [ngClass]="{
    'max-h-[600px] opacity-100 pb-4': isSectionOpen['tier'],
    'max-h-0 opacity-0': !isSectionOpen['tier']
  }"
>
  <div class="px-4 pl-4">
    <label class="flex items-center gap-2 py-1">
      <input type="checkbox" class="w-4 h-4 accent-blue-600 cursor-pointer" />
      <span class="text-sm font-medium text-gray-900">Tier 1</span>
    </label>

    <label class="flex items-center gap-2 py-1">
      <input type="checkbox" class="w-4 h-4 accent-blue-600 cursor-pointer" />
      <span class="text-sm font-medium text-gray-900">Tier 2</span>
    </label>

    <label class="flex items-center gap-2 py-1">
      <input type="checkbox" class="w-4 h-4 accent-blue-600 cursor-pointer" />
      <span class="text-sm font-medium text-gray-900">Tier 3</span>
    </label>
  </div>
</div>

    </div>

    <div class="accordion-section pt-4 pb-4 border-b">
      <div class="accordion-header flex justify-between items-center py-4 px-4 cursor-pointer" (click)="openVehiclesModal()">
        <span class="text-sm font-medium text-gray-900 hover:text-[#2563EB] transition-colors duration-200">Veículos</span>
        <svg class="icon size-5 text-gray-500 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m6 9 6 6 6-6"></path>
        </svg>
      </div>
      </div>

    <div class="accordion-section pt-4 pb-4 border-b">
      <div class="accordion-header flex justify-between items-center py-4 px-4 cursor-pointer" (click)="toggleSection('sentiment')">
        <span class="text-sm font-medium text-gray-900 hover:text-[#2563EB] transition-colors duration-200">Sentimento</span>
        <svg [ngClass]="{'rotate-180': isSectionOpen.sentiment}" class="icon size-5 text-gray-500 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m6 9 6 6 6-6"></path>
        </svg>
      </div>
      <div class="px-4  pl-4" [ngClass]="{'hidden': !isSectionOpen.sentiment}">
        <label class="flex items-center gap-2 py-1">
          <input type="checkbox" [(ngModel)]="sentiments.positive" class="w-4 h-4 accent-blue-600 cursor-pointer" />
          <span class="text-sm font-medium text-gray-900">Positivo</span>
        </label>
        <label class="flex items-center gap-2 py-1">
          <input type="checkbox" [(ngModel)]="sentiments.neutral" class="w-4 h-4 accent-blue-600 cursor-pointer" />
          <span class="text-sm font-medium text-gray-900">Neutro</span>
        </label>
        <label class="flex items-center gap-2 py-1">
          <input type="checkbox" [(ngModel)]="sentiments.negative" class="w-4 h-4 accent-blue-600 cursor-pointer" />
          <span class="text-sm font-medium text-gray-900">Negativo</span>
        </label>
      </div>
    </div>

    <div class="accordion-section pt-4 pb-4 border-b">
      <div class="accordion-header flex justify-between items-center py-4 px-4 cursor-pointer" (click)="openLocationModal()">
        <div class="flex items-center">
          <span class="text-sm font-medium text-gray-900 hover:text-[#2563EB] transition-colors duration-200">Localização</span>
          <div class="relative inline-block ml-2">
            <svg class="cursor-pointer transition-colors duration-200 tooltip-trigger" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" class="fill-[#4B5563] hover:fill-gray-900" />
              <path d="M12 7v6h0.01" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="none" />
              <circle cx="12" cy="16" r="1.5" fill="white" />
            </svg>
            <span class="absolute left-1/2 transform -translate-x-1/2 top-full mt-2 whitespace-nowrap min-w-[240px] bg-gray-900 text-white text-xs font-normal py-2 px-4 rounded-md shadow-md opacity-0 transition-opacity duration-200 z-50 tooltip-location">
              O parâmetro de localização não funciona para <br> os tipos de mídia Web
            </span>
          </div>
        </div>
        <svg [ngClass]="{'rotate-180': isLocationModalOpen}" class="icon size-5 text-gray-500 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m6 9 6 6 6-6"></path>
        </svg>
      </div>
      <div class="modal-container relative z-20" *ngIf="isLocationModalOpen">
        <app-localizacao ></app-localizacao>
      </div>
    </div>

    <div class="fixed bottom-0 left-0 w-[476px] h-[78px] bg-white border-t border-gray-200 shadow-[0px_10px_40px_10px_rgba(0,0,0,0.08)] flex justify-end items-center px-4 gap-3 z-50">
  
      <button class="w-[159px] h-[46px] flex justify-center items-center px-4 py-2 rounded-lg text-sm font-semibold text-white bg-gray-700 hover:bg-gray-900 transition-colors" (click)="navigateToResults()">
        Filtrar dashboard
      </button>
    </div>
  </div>
</div>