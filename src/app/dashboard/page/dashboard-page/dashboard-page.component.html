<div class="flex h-screen w-full bg-white overflow-hidden">
  <!-- SIDEBAR -->
  <aside class="h-full flex-shrink-0 z-50 bg-neutral-800 text-white transition-all duration-300">
    <app-side-bar
      [isSidebarOpen]="sidebarOpen"
      (sidebarToggled)="onSidebarToggle($event)"
      (openModalExternally)="toggleModal()">
    </app-side-bar>
  </aside>

  <!-- MAIN (scroll aqui) -->
  <main class="flex-1 min-h-0 overflow-y-auto overflow-x-hidden relative">
    <div class="w-full max-w-[1600px] mx-auto p-6 md:p-8 space-y-8">
      <!-- HEADER -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
        <div>
          <h1 class="text-[24px] font-bold text-[#1F2937] leading-[32px]">Dashboard</h1>
          <p class="text-[14px] text-[#6B7280]">Indicadores da busca salva selecionada</p>
        </div>

        <div class="flex items-center gap-2">
          <span class="text-[12px] font-medium text-[#6B7280]">Busca salva:</span>

          <div class="relative w-[212px]">
            <select
              class="w-full h-[46px] pl-4 pr-10 bg-white border border-[#E5E7EB] rounded-[8px] text-[15px] font-medium text-[#1F2937] appearance-none outline-none focus:ring-2 focus:ring-blue-500/20 cursor-pointer shadow-sm">
              <option>Ministros</option>
              <option>STF Geral</option>
            </select>

            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-500">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6"></path>
              </svg>
            </div>
          </div>

          <button
            (click)="openFilter()"
            class="w-[48px] h-[48px] flex items-center justify-center bg-white border border-[#E9EAEB] rounded-[8px] shadow-sm hover:bg-gray-50 transition-colors">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M2 3C2 2.44772 2.44772 2 3 2H13C13.5523 2 14 2.44772 14 3V4.17157C14 4.43679 13.8946 4.69112 13.7071 4.87868L9.41421 9.17157C9.03914 9.54665 9.03914 10.1549 9.41421 10.53L10 11.1158"
                stroke="#535862" stroke-linecap="round" stroke-linejoin="round" />
              <path
                d="M6.58579 9.17157L2.29289 4.87868C2.10536 4.69112 2 4.43679 2 4.17157V3Z"
                stroke="#535862" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M6 9L6 13L10 11" stroke="#535862" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>
      </div>

      <!-- SECTION 1 -->
      <section
        class="bg-white border border-[#F3F4F6] shadow-sm rounded-lg overflow-visible w-full flex flex-col xl:flex-row min-h-[460px]">
        <div
          class="w-full xl:w-[280px] flex flex-col justify-center items-center border-b xl:border-b-0 xl:border-r border-[#F3F4F6] flex-shrink-0 py-6 xl:py-0">
          <app-VerticalStatsCard [statsData]="dashboardData?.stats" [isLoading]="isLoading"></app-VerticalStatsCard>
        </div>

        <div class="flex-1 p-[24px] min-w-0 overflow-visible flex flex-col">
          <app-volume-chart
            class="flex-1 w-full h-full"
            [volumeDataRaw]="dashboardData?.volume"
            [chartTitle]="'Volume de ocorrências'"
            [chartSubtitle]="'Total de notícias capturadas das palavras-chaves selecionadas'"
            [isLoading]="isLoading">
          </app-volume-chart>
        </div>
      </section>

      <!-- SECTION 2 -->
      <section class="w-full bg-white border border-[#F3F4F6] shadow-sm rounded-lg overflow-visible">
        <app-protagonism-banner class="block w-full" [data]="dashboardData?.protagonism" [isLoading]="isLoading">
        </app-protagonism-banner>
      </section>

      <!-- SECTION 3 -->
      <section class="w-full grid grid-cols-1 lg:grid-cols-3 gap-6 items-stretch overflow-visible">
        <div class="bg-white border border-[#F3F4F6] shadow-sm rounded-lg overflow-visible">
          <app-media-chart [data]="dashboardData?.mediaData" [isLoading]="isLoading"></app-media-chart>
        </div>

        <div class="bg-white border border-[#F3F4F6] shadow-sm rounded-lg overflow-visible">
          <app-index-chart [data]="dashboardData?.relevanceData" [isLoading]="isLoading"></app-index-chart>
        </div>

        <div class="bg-white border border-[#F3F4F6] shadow-sm rounded-lg overflow-visible">
          <app-index-chart [data]="dashboardData?.qualityData" [isLoading]="isLoading"></app-index-chart>
        </div>
      </section>

      <br />

      <!-- TABLE 1 -->
      <app-mentions-table
        [data]="dashboardData?.entityMentions"
        [isLoading]="isLoading"
        searchPlaceholder="Buscar entidade">
      </app-mentions-table>

      <!-- SECTION 4 -->
      <section
        class="bg-white border border-[#F3F4F6] shadow-sm rounded-lg overflow-visible w-full flex flex-col xl:flex-row min-h-[460px]">
        <div
          class="w-full xl:w-[280px] flex flex-col justify-center items-center border-b xl:border-b-0 xl:border-r border-[#F3F4F6] flex-shrink-0 py-6 xl:py-0">
          <app-VerticalStatsCard [statsData]="dashboardData?.statsTiers" [isLoading]="isLoading"></app-VerticalStatsCard>
        </div>

        <div class="flex-1 p-6 min-w-0 overflow-visible flex flex-col">
          <app-volume-chart
            class="flex-1 w-full h-full"
            [volumeDataRaw]="dashboardData?.volumeTiers"
            [chartTitle]="'Volume por tiers'"
            [chartSubtitle]="'Determinam a relevância do veículo para o contexto analisado'"
            [isLoading]="isLoading">
          </app-volume-chart>
        </div>
      </section>

      <br />

      <!-- TABLE 2 -->
      <app-mentions-table
        [data]="dashboardData?.vehicleMentions"
        [isLoading]="isLoading"
        [showVehicleStats]="true"
        [vehicleCount]="14"
        [totalVehicles]="20">
      </app-mentions-table>

<section class="w-full bg-white border border-[#F3F4F6] shadow-sm rounded-lg overflow-hidden">
  <div class="p-6">
    <h2 class="text-[16px] font-bold text-[#1F2937]">Distribuição de menção por Geolocalização</h2>
    <p class="text-[13px] text-[#6B7280]">Aplica-se apenas a veículos de rádio, TV e impressos.</p>
  </div>

  <div class="px-6 pb-6">
    <div class="w-full rounded-lg border border-[#F3F4F6] overflow-hidden bg-white">
      <div class="flex flex-col lg:flex-row w-full">
        <!-- LEFT: MAP -->
        <div class="w-full lg:w-[520px] xl:w-[560px] p-4 lg:p-5 border-b lg:border-b-0 lg:border-r border-[#F3F4F6]">
          <div class="w-full h-[420px] lg:h-[460px] rounded-lg overflow-hidden bg-w relative">
            <!-- aqui fica teu mapa/globo -->
            <app-globe class="block w-full h-full"></app-globe>

            <!-- (opcional) overlay de loading/placeholder -->
            <!--
            <div class="absolute inset-0 flex items-center justify-center text-[#6B7280] text-sm">
              Carregando mapa...
            </div>
            -->
          </div>
        </div>

        <!-- RIGHT: TABLE -->
        <div class="flex-1 min-w-0">
          <!-- table header -->
          <div class="flex items-center justify-between px-5 py-4 border-b border-[#F3F4F6]">
            <div class="text-[13px] font-medium text-[#6B7280]">Nome</div>

            <div class="flex items-center gap-3">
              <div class="text-[13px] font-medium text-[#6B7280]">Alcance estimado</div>

              <button
                class="w-9 h-9 rounded-md border border-[#E5E7EB] bg-white hover:bg-[#F9FAFB] flex items-center justify-center"
                title="Ordenar">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2">
                  <path d="M7 7h14M7 12h10M7 17h6"></path>
                  <path d="M3 7v14"></path>
                  <path d="M3 21l-2-2"></path>
                  <path d="M3 21l2-2"></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- rows -->
          <div class="divide-y divide-[#F3F4F6]">
            <!-- row -->
            <div class="flex items-center justify-between px-5 py-4 hover:bg-[#FAFAFA]">
              <div class="flex items-center gap-3 min-w-0">
                <span class="w-2.5 h-2.5 rounded-full bg-red-500 flex-shrink-0"></span>
                <div class="min-w-0">
                  <div class="text-[14px] font-semibold text-[#111827] truncate">Rádio Itatiaia</div>
                  <div class="text-[12px] text-[#6B7280] truncate">Brasília - DF</div>
                </div>
              </div>

              <div class="flex items-center gap-6 flex-shrink-0">
                <button class="w-9 h-9 rounded-md hover:bg-[#F3F4F6] flex items-center justify-center" title="Ouvir">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="2">
                    <path d="M11 5L6 9H2v6h4l5 4z"></path>
                    <path d="M15.5 8.5a5 5 0 010 7"></path>
                    <path d="M18 6a8.5 8.5 0 010 12"></path>
                  </svg>
                </button>

                <div class="text-[14px] font-semibold text-[#111827] w-[60px] text-right">3M</div>
              </div>
            </div>

            <div class="flex items-center justify-between px-5 py-4 hover:bg-[#FAFAFA]">
              <div class="flex items-center gap-3 min-w-0">
                <span class="w-2.5 h-2.5 rounded-full bg-green-500 flex-shrink-0"></span>
                <div class="min-w-0">
                  <div class="text-[14px] font-semibold text-[#111827] truncate">BandNews FM</div>
                  <div class="text-[12px] text-[#6B7280] truncate">São Paulo - SP</div>
                </div>
              </div>

              <div class="flex items-center gap-6 flex-shrink-0">
                <button class="w-9 h-9 rounded-md hover:bg-[#F3F4F6] flex items-center justify-center" title="Ouvir">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="2">
                    <path d="M11 5L6 9H2v6h4l5 4z"></path>
                    <path d="M15.5 8.5a5 5 0 010 7"></path>
                    <path d="M18 6a8.5 8.5 0 010 12"></path>
                  </svg>
                </button>

                <div class="text-[14px] font-semibold text-[#111827] w-[60px] text-right">4M</div>
              </div>
            </div>

            <div class="flex items-center justify-between px-5 py-4 hover:bg-[#FAFAFA]">
              <div class="flex items-center gap-3 min-w-0">
                <span class="w-2.5 h-2.5 rounded-full bg-blue-500 flex-shrink-0"></span>
                <div class="min-w-0">
                  <div class="text-[14px] font-semibold text-[#111827] truncate">Jovem Pan</div>
                  <div class="text-[12px] text-[#6B7280] truncate">Rio de Janeiro - RJ</div>
                </div>
              </div>

              <div class="flex items-center gap-6 flex-shrink-0">
                <button class="w-9 h-9 rounded-md hover:bg-[#F3F4F6] flex items-center justify-center" title="Ouvir">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="2">
                    <path d="M11 5L6 9H2v6h4l5 4z"></path>
                    <path d="M15.5 8.5a5 5 0 010 7"></path>
                    <path d="M18 6a8.5 8.5 0 010 12"></path>
                  </svg>
                </button>

                <div class="text-[14px] font-semibold text-[#111827] w-[60px] text-right">1.5M</div>
              </div>
            </div>

            <div class="flex items-center justify-between px-5 py-4 hover:bg-[#FAFAFA]">
              <div class="flex items-center gap-3 min-w-0">
                <span class="w-2.5 h-2.5 rounded-full bg-purple-500 flex-shrink-0"></span>
                <div class="min-w-0">
                  <div class="text-[14px] font-semibold text-[#111827] truncate">Rádio Gaúcha</div>
                  <div class="text-[12px] text-[#6B7280] truncate">Porto Alegre - RS</div>
                </div>
              </div>

              <div class="flex items-center gap-6 flex-shrink-0">
                <button class="w-9 h-9 rounded-md hover:bg-[#F3F4F6] flex items-center justify-center" title="Ouvir">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="2">
                    <path d="M11 5L6 9H2v6h4l5 4z"></path>
                    <path d="M15.5 8.5a5 5 0 010 7"></path>
                    <path d="M18 6a8.5 8.5 0 010 12"></path>
                  </svg>
                </button>

                <div class="text-[14px] font-semibold text-[#111827] w-[60px] text-right">5M</div>
              </div>
            </div>
          </div>

          <!-- pagination -->
          <div class="flex items-center justify-end gap-2 px-5 py-4 border-t border-[#F3F4F6]">
            <button class="w-9 h-9 rounded-md border border-[#E5E7EB] bg-white hover:bg-[#F9FAFB] flex items-center justify-center">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2">
                <path d="M15 18l-6-6 6-6"></path>
              </svg>
            </button>

            <button class="w-9 h-9 rounded-md border border-[#E5E7EB] bg-white hover:bg-[#F9FAFB] text-[13px] font-medium text-[#111827]">1</button>
            <button class="w-9 h-9 rounded-md border border-[#E5E7EB] bg-[#F3F4F6] text-[13px] font-semibold text-[#111827]">2</button>
            <button class="w-9 h-9 rounded-md border border-[#E5E7EB] bg-white hover:bg-[#F9FAFB] text-[13px] font-medium text-[#111827]">3</button>

            <button class="w-9 h-9 rounded-md border border-[#E5E7EB] bg-white hover:bg-[#F9FAFB] flex items-center justify-center">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2">
                <path d="M9 18l6-6-6-6"></path>
              </svg>
            </button>
          </div>
        </div>
        <!-- /RIGHT -->
      </div>
    </div>
  </div>
</section>

    </div>
  </main>

  <!-- FILTER (só renderiza quando aberto, pra não “cobrir” a tela invisível) -->
  <app-dashboard-filter
    *ngIf="isFilterOpen"
    [isVisible]="isFilterOpen"
    (close)="closeFilter()"
    (openVehiclesModalRequest)="openVehiclesModal()"
    (openLocationModalRequest)="openLocationModal()">
  </app-dashboard-filter>

  <!-- MODAL VEÍCULOS -->
  <div *ngIf="isVehiclesModalOpen" class="fixed inset-0 z-[9999]">
    <div
      class="absolute inset-0 bg-[#111827]/40 backdrop-blur-sm"
      (click)="closeVehiclesModal()">
    </div>

    <div class="relative z-10 flex items-center justify-center p-4" (click)="$event.stopPropagation()">
      <app-veiculos mode="tier" (close)="closeVehiclesModal()"></app-veiculos>
    </div>
  </div>

  <!-- MODAL LOCALIZAÇÃO -->
  <app-localizacao *ngIf="isLocationModalOpen" (close)="closeLocationModal()"></app-localizacao>
</div>
