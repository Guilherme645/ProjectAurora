<div *ngIf="!isMobile" class="fixed inset-0 z-[9999] flex items-center justify-center p-4">
  <div class="absolute inset-0 bg-[#111827]/40 backdrop-blur-sm transition-opacity" (click)="closeModal()"></div>

  <div class="relative w-[645px] h-[500px] bg-white shadow-2xl rounded-2xl border border-gray-200 flex flex-col overflow-hidden"
       (click)="$event.stopPropagation()">

    <!-- header -->
    <div class="flex items-center justify-between bg-white px-6 py-4 h-[73px] w-full border-b flex-shrink-0">
      <div class="relative w-full">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="lucide stroke-1 text-gray-400 absolute left-0 top-1/2 transform -translate-y-1/2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21 -4.3-4.3"></path>
        </svg>

        <input
          type="text"
          placeholder="Procurar veículos"
          [(ngModel)]="searchQuery"
          class="w-full bg-white text-gray-900 placeholder-gray-400 focus:outline-none pl-8 py-2 border-none text-[14px]"
          (ngModelChange)="searchQuery = $event.trim(); updateSelectAll()"
        />
      </div>

      <button class="ml-4 text-[10px] font-bold text-gray-500 flex justify-center items-center px-1.5 py-0.5 border border-gray-200 rounded-[4px] bg-gray-50 hover:bg-gray-100"
              (click)="closeModal()">
        ESC
      </button>
    </div>

    <!-- body -->
    <div class="flex flex-grow w-[645px] h-[382px] pt-2 rounded-b-2xl overflow-hidden">
      <!-- sidebar -->
      <nav class="w-[150px] border-r border-gray-200 p-4 bg-white">
        <ul class="space-y-3">
          <li
            *ngFor="let g of groups"
            class="flex items-center gap-2 cursor-pointer px-2 py-2 rounded-lg"
            [ngClass]="{'text-blue-600 font-medium': selectedGroup === g, 'text-gray-600': selectedGroup !== g}"
            (click)="selectGroup(g)"
          >
            <span [ngClass]="{'text-blue-600 font-medium': selectedGroup === g, 'text-gray-600': selectedGroup !== g}">
              {{ g }}
            </span>
          </li>
        </ul>
      </nav>

      <!-- list -->
      <div class="p-4 flex-1 max-h-[382px] overflow-y-auto bg-white">
        <span class="block text-sm font-medium text-gray-700 text-left mb-3">
          {{ getGroupTitle() }}
        </span>

        <label class="flex items-center gap-x-2 text-sm font-medium text-gray-700 mb-6">
          <input type="checkbox"
                 class="rounded text-blue-600 focus:ring-blue-500"
                 [(ngModel)]="selectAll"
                 (change)="toggleSelectAll()"/>
          <ng-container *ngIf="mode === 'tier'; else categorySelectAll">
            Selecionar todos os veículos do {{ selectedGroup.toLowerCase() }} ({{ getSelectedGroupTotal() }})
          </ng-container>
          <ng-template #categorySelectAll>
            Selecionar todos os veículos de {{ selectedGroup }}
          </ng-template>
        </label>

        <div class="grid grid-cols-2 gap-x-6 gap-y-3 pr-2">
          <label *ngFor="let v of getFilteredVehicles()" class="flex items-center gap-x-2 text-sm font-medium">
            <input type="checkbox"
                   class="rounded text-blue-600 focus:ring-blue-500"
                   [(ngModel)]="v.selecionado"
                   (change)="updateSelectAll()"/>
            {{ v.nome }}
          </label>
        </div>
      </div>
    </div>

    <!-- footer -->
    <div class="w-full border-t p-4 flex justify-end bg-white rounded-b-2xl">
      <button type="button"
              class="py-3 px-6 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg bg-black text-white hover:bg-gray-800"
              (click)="closeModal()">
        Utilizar veículos selecionados
      </button>
    </div>
  </div>
</div>
